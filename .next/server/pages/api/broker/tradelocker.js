"use strict";(()=>{var e={};e.id=227,e.ids=[227],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},7410:(e,t,r)=>{r.r(t),r.d(t,{config:()=>k,default:()=>h,routeModule:()=>v});var s={};r.r(s),r.d(s,{default:()=>c});var a=r(1802),n=r(7153),o=r(6249),u=r(6874);async function c(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{action:r,config:s,order:a}=e.body;switch(r){case"connect":return await i(e,t,s);case"test":return await l(e,t,s);case"balance":return await d(e,t,s);case"price":return await f(e,t,s);case"market_order":return await y(e,t,s,a);case"limit_order":return await p(e,t,s,a);case"positions":return await w(e,t,s);case"close_position":return await j(e,t,s,a);case"order_history":return await m(e,t,s);case"cancel_order":return await g(e,t,s,a);default:return t.status(400).json({error:"Invalid action"})}}catch(e){return console.error("TradeLocker API error:",e),t.status(500).json({error:"Internal server error",details:e.message})}}async function i(e,t,r){try{let e=new u.f(r);if(!await e.testConnection())return t.status(400).json({error:"Failed to connect to TradeLocker"});return await e.saveConfig(),t.status(200).json({success:!0,message:"Successfully connected to TradeLocker"})}catch(e){return t.status(400).json({error:e.message})}}async function l(e,t,r){try{let e=new u.f(r),s=await e.testConnection();return t.status(200).json({success:s,message:s?"Connection successful":"Connection failed"})}catch(e){return t.status(400).json({error:e.message})}}async function d(e,t,r){try{let e=new u.f(r),s=await e.getBalance();return t.status(200).json({success:!0,data:s})}catch(e){return t.status(400).json({error:e.message})}}async function f(e,t,r){try{let{symbol:s}=e.body;if(!s)return t.status(400).json({error:"Symbol is required"});let a=new u.f(r),n=await a.getCurrentPrice(s);return t.status(200).json({success:!0,data:{symbol:s,price:n}})}catch(e){return t.status(400).json({error:e.message})}}async function y(e,t,r,s){try{let{symbol:e,side:a,quantity:n,stopLoss:o,takeProfit:c}=s;if(!e||!a||!n)return t.status(400).json({error:"Symbol, side, and quantity are required"});let i=new u.f(r),l=await i.placeMarketOrder({symbol:e,side:a,type:"market",quantity:parseFloat(n),stopLoss:o?parseFloat(o):void 0,takeProfit:c?parseFloat(c):void 0});return t.status(200).json({success:!0,data:l})}catch(e){return t.status(400).json({error:e.message})}}async function p(e,t,r,s){try{let{symbol:e,side:a,quantity:n,price:o,stopLoss:c,takeProfit:i}=s;if(!e||!a||!n||!o)return t.status(400).json({error:"Symbol, side, quantity, and price are required"});let l=new u.f(r),d=await l.placeLimitOrder({symbol:e,side:a,type:"limit",quantity:parseFloat(n),price:parseFloat(o),stopLoss:c?parseFloat(c):void 0,takeProfit:i?parseFloat(i):void 0});return t.status(200).json({success:!0,data:d})}catch(e){return t.status(400).json({error:e.message})}}async function w(e,t,r){try{let e=new u.f(r),s=await e.getPositions();return t.status(200).json({success:!0,data:s})}catch(e){return t.status(400).json({error:e.message})}}async function j(e,t,r,s){try{let{symbol:e,quantity:a}=s;if(!e)return t.status(400).json({error:"Symbol is required"});let n=new u.f(r),o=await n.closePosition(e,a?parseFloat(a):void 0);return t.status(200).json({success:!0,data:o})}catch(e){return t.status(400).json({error:e.message})}}async function m(e,t,r){try{let{symbol:s,limit:a}=e.body,n=new u.f(r),o=await n.getOrderHistory(s,a||100);return t.status(200).json({success:!0,data:o})}catch(e){return t.status(400).json({error:e.message})}}async function g(e,t,r,s){try{let{orderId:e}=s;if(!e)return t.status(400).json({error:"Order ID is required"});let a=new u.f(r),n=await a.cancelOrder(e);return t.status(200).json({success:!0,data:n})}catch(e){return t.status(400).json({error:e.message})}}let h=(0,o.l)(s,"default"),k=(0,o.l)(s,"config"),v=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/broker/tradelocker",pathname:"/api/broker/tradelocker",bundlePath:"",filename:""},userland:s})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[272],()=>r(7410));module.exports=s})();